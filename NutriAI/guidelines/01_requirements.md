# NutriAI 要件定義書

## 1. プロジェクト概要
- プロジェクト名: NutriAI
- コンセプト: 写真解析と大規模言語モデルを活用して、トレーニー／ダイエッターの目標設定と日々の記録を支援する。
- フェーズ構成: 第1フェーズはReactまたはNext.jsを用いたPWAとして提供し、以降Flutterでネイティブアプリを展開する。
- デザイン指針: 若年層向けのモダンなトーンとマナー。ブランドカラーは柔らかい緑(#3CB371系)と白を基調にアクセントとして濃い緑を用いる。

## 2. 背景と課題
- 食事・運動・体重の一元管理は手間がかかり継続が難しい。
- 既存アプリはデータ入力の負荷が高く、個別性の高いアドバイスが得られにくい。
- 写真から栄養推定を行うニーズが高まる一方で、利用ハードルが高い。
- 目標設定を自分で行う負担が大きく、実際のライフスタイルと乖離しやすい。

## 3. プロジェクト目標とKPI
- 主要目標: 「とにかく楽にダイエットや筋トレをサポート」できる体験を提供する。
- 成功指標例
  - 初回利用から7日間の継続率: 40%以上
  - 食事登録完了率(1日あたり3食記録): 60%以上
  - 目標設定ウィザード完了率: 80%以上
  - チャット相談の週次継続率: 30%以上

## 4. ターゲットユーザーとペルソナ
- ペルソナA: 25歳 女性 事務職。ダイエット歴はあるが継続力に課題。調理写真のSNS投稿に慣れている。目的は-5kg(3か月)。
- ペルソナB: 30歳 男性 IT系。筋力トレーニングを週3回。体脂肪率を20%→15%に下げたい。カロリー計算が苦手。
- 共通ニーズ: 入力手間の軽減、客観的な目標設定、日々のモチベーション維持、AIによる疑問解決。

## 5. 提供チャネルと技術前提
- クライアント: PWA(React/Next.js)でレスポンシブ対応。オフラインキャッシュとプッシュ通知(Phase2)を見据える。
- 将来展開: FlutterによるiOS/Androidアプリ。コンポーネント設計はPWAとの共通化を前提にAtomic Designを採用。
- サードパーティ連携候補: JANコードデータベース、一般食品DB、クラウドLLM(APIプロバイダ未確定)。

## 6. ユースケース
| ID | ユーザー行動 | システム応答 | 成功条件 |
| --- | --- | --- | --- |
| UC-01 | 初回起動で基本情報と目標を入力 | AIが期間・体重増減幅を提案しユーザーが確定 | 5分以内にゴールが確定する |
| UC-02 | 体重を入力 | 日々の推移グラフと目標との差分を更新 | 前日比と累計差分が可視化される |
| UC-03 | 食事写真を撮影し補足テキストを入力 | AIが推定マクロ栄養素を提示し登録 | 80%以上の入力がワンタップで完了する |
| UC-04 | JANコードをスキャン | 食品データを表示し記録に追加 | 該当がない場合は手動登録フォームを提示 |
| UC-05 | チャットで相談 | LLMがユーザー文脈を踏まえたアドバイスを返信 | 返信まで3秒以内(モック期間中は即時応答) |
| UC-06 | 月次レビューを確認 | 実績TDEEと推奨カロリーを再提案 | ユーザーが「受け入れる/調整する」を選べる |

## 7. 機能要件
### 7.1 必須(MVP)
- アカウント&初期設定: 基本情報、目的、生活習慣の入力とAIによる初期目標提案。
- ダッシュボード: 当日サマリー(摂取/消費カロリー、PFCバランス、体重推移、タスク)。
- 食事管理: 写真アップロード、補足テキスト、AIマクロ推定、手動編集、JANコード登録、履歴一覧。
- 運動管理: 種目選択、消費カロリー推定、テンプレート保存、週次集計。
- 体重・体脂肪ログ: 日次入力、グラフ表示、目標との差分表示。
- LLMチャット: カテゴリ別プリセット(栄養相談/トレーニング/メンタル)と自由入力。
- 月次レビュー: 実績データに基づくTDEE推定と目標再設定提案。
- 通知・リマインダー: ブラウザ通知によるログ入力リマインド(モック段階ではToDo表示のみ)。

### 7.2 将来拡張
- ウェアラブル端末連携(Google Fit, Apple Health, Fitbit)。
- コミュニティ機能(仲間の進捗共有)。
- 推奨レシピの提案や買い物リスト自動生成。
- サブスクリプション課金(プレミアム機能)。

## 8. 非機能要件
- パフォーマンス: 主要画面の初期表示を1.5秒以内(PWA)、AI応答はモック期間で即時、その後5秒以内を目標。
- 信頼性: 重要データはフロント側でローカルキャッシュし、送信失敗時はリトライキューを保持。
- セキュリティ: HTTPS必須、PIIは暗号化保存、チャットログは個人特定情報をマスキング。
- アクセシビリティ: WCAG 2.1 AA準拠を目標。フォントサイズ変更、色覚多様性対応テーマ。
- 運用性: 監視ダッシュボード(後続)、APIリクエスト/レスポンスの構造はOpenAPIで管理。
- スケーラビリティ: 画像処理・LLMはマイクロサービス化、非同期ジョブキューを利用。

## 9. データとコンテンツ
- 食品データ: JANコードと一般食品カテゴリを保持。初期はモックデータを用意し、実データ導入時の移行を考慮。
- 画像データ: クライアントからクラウドストレージへアップロード。モック期間はローカルURLを利用。
- AIプロンプト: 利用開始時の質問テンプレート、チャットガイドラインを定義。

## 10. モックデータ運用方針
- データ層は`DataProvider`インタフェースで抽象化し、モック(ローカルJSON/IndexedDB/MSW)と本番APIを切り替え可能にする。
- モックはリポジトリ単位で定義し、型定義(TypeScript)で契約を固定。OpenAPIスキーマから型生成を行い差分を検知。
- 状態同期はクライアント内で完結させ、API接続時には同一メソッド署名でリプレースする。
- 画像アップロード等の重たい処理はスタブ化し、成功・失敗パターンどちらも再現できるシードデータを整備する。

## 11. リスクと対応
- AI推定精度: 食品写真の撮影条件で誤差が生じる → 補足テキスト入力、修正UIを提供。
- 個人情報保護: 体組成データの扱い → 個人データ保護方針、削除要求への応答手順を整備。
- JANコード網羅性: 未登録データが多い → ユーザー投稿内容のレビュー導線を設計。
- モチベーション低下: 継続利用を促す → 週次レポートと小さな成功体験(バッジ)を用意。

## 12. マイルストン(暫定)
- M0: ペルソナ確定、画面遷移図、モックデータ仕様(2週間)。
- M1: PWAモック完成(ログ/食事/運動/チャット)(4週間)。
- M2: 画像解析・JANスキャンのPoC、LLMプロンプト調整(4週間)。
- M3: API実装・Flutter版設計着手(6週間)。
