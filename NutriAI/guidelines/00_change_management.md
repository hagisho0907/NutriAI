# NutriAI 変更管理ポリシー

## 目的
- 機能開発・UI改修・データ構造変更に伴い、必ず設計資産を最新化してからコードをマージする。
- Claude Codeを含む全エージェントが同じ情報源を参照し、差分の取りこぼしや再作業を防ぐ。

## 適用範囲
- `NutriAI/guidelines/` 配下の設計書
- `reports/` 配下のブリーフ・振り返りドキュメント
- `figma/`、`docs/` などの外部設計リソースへのリンク集

## トリガーイベント
- **機能追加 / 仕様変更**: ユースケース、画面挙動、ユースフローが変わる場合
- **UI・ビジュアル更新**: デザイン要素、コンポーネント仕様、アクセシビリティ要件の変更
- **データ構造・API変更**: ERD、API契約、データフローが変わる場合
- **AI/MLワークフロー改修**: 推論プロンプト、AI UXの導線を調整する場合

## 必須アウトプット
1. **設計書更新**
   - 影響する設計書（例: `02_screen_design.md`, `06_features_detail.md`, `07_system_architecture.md`）を修正。
   - 各設計書末尾の「更新履歴」に変更サマリを追記。
2. **コンテキストブリーフ**
   - `reports/context/` に日付付きファイル（例: `reports/context/2025-10-21.md`）を追加。
   - 変更概要／影響範囲／未決事項／次のアクションを整理。
3. **PR概要**
   - 実装PR説明欄に「設計更新リンク」「ブリーフリンク」「テンプレート準拠済」を明記。

## 作業フロー（Claude Code 向け指示例）
1. `guidelines/00_change_management.md` と対象設計書、該当テンプレートを会話に読み込む。
2. 「変更管理チェックリスト」を順番に実行させ、各成果物を更新。
3. 変更した設計書とレポートのファイルパスを列挙し、差分を確認。
4. すべて完了したら実装タスクに着手するよう明示する。

## 変更管理チェックリスト
- [ ] 変更対象機能・画面・APIを洗い出し、影響ファイルを列挙したか
- [ ] `guidelines/templates/design_update.md` を元に設計更新案を下書きしたか
- [ ] 関連設計書を更新し、日付付きの注記を挿入したか
- [ ] `reports/context/` にブリーフを作成・追記したか
- [ ] 実装PRに更新ファイルとブリーフのリンクを掲載したか
- [ ] QA/他Subagentへの共有事項があれば `reports/context/` ブリーフに記載したか

## Claude Code 用テンプレート
- 設計更新案: `guidelines/templates/design_update.md`
- コンテキストブリーフ: `guidelines/templates/context_brief.md`（未作成の場合は当ポリシーに沿って作成）

## 運用メモ
- ブリーフは原則 24 時間以内に作成する。期限を超える場合は `reports/context/` に理由と新期限を書く。
- 設計と実装に差分がある場合は、設計更新を先にマージし、その後実装PRをレビューへ回す。
- 変更の規模が小さくても、影響なしの根拠をブリーフに明記する。

## 更新履歴
- 2025-10-21: 初版作成（変更管理ポリシー、チェックリスト、テンプレート運用方針を定義）
